<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Weighted Random Function</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-weight: bold;
            color: #555;
        }

        input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100px;
        }

        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Demo Hàm Weighted Random Integer</h1>

        <div class="controls">
            <div class="control-group">
                <label for="min">Min:</label>
                <input type="number" id="min" value="1" min="0">
            </div>
            <div class="control-group">
                <label for="max">Max:</label>
                <input type="number" id="max" value="20" min="1">
            </div>
            <div class="control-group">
                <label for="focus">Focus:</label>
                <input type="number" id="focus" value="10" min="1">
            </div>
            <div class="control-group">
                <label for="strength">Strength:</label>
                <input type="number" id="strength" value="5" min="0" step="0.1">
            </div>
            <div class="control-group">
                <label for="decay">Decay:</label>
                <input type="number" id="decay" value="1" min="0" step="0.1">
            </div>
            <div class="control-group">
                <label for="iterations">Số lần test:</label>
                <input type="number" id="iterations" value="10000" min="1000" step="1000">
            </div>
        </div>

        <button onclick="runTest()">Chạy Test</button>

        <div class="stats" id="stats" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="totalTests">0</div>
                <div class="stat-label">Tổng số lần test</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="focusCount">0</div>
                <div class="stat-label">Số lần rơi vào focus</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="focusPercentage">0%</div>
                <div class="stat-label">Tỷ lệ focus</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="average">0</div>
                <div class="stat-label">Giá trị trung bình</div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="chart"></canvas>
        </div>
    </div>

    <script>
        // Hàm weightedRandomInt
        function weightedRandomInt(min, max, focus, strength = 20, decay = 3, defaultWeight = 10) {
            const size = max - min + 1;

            // 1. Tạo trọng số cho từng số
            const weights = Array.from({ length: size }, (_, i) => {
                const dist = Math.abs(i - (focus - min));
                return Math.max(defaultWeight + strength - decay * dist, defaultWeight);
            });

            // 2. Tính mảng cộng dồn (cumulative sum)
            const cumulative = [];
            weights.reduce((sum, w) => {
                sum += w;
                cumulative.push(sum);
                return sum;
            }, 0);

            // 3. Random 1 số theo tổng trọng số
            const random = Math.random() * cumulative[cumulative.length - 1];

            // 4. Tìm vị trí số random rơi vào
            return min + cumulative.findIndex(total => total > random);
        }


        let chart = null;

        function runTest() {
            const min = parseInt(document.getElementById('min').value);
            const max = parseInt(document.getElementById('max').value);
            const focus = parseInt(document.getElementById('focus').value);
            const strength = parseFloat(document.getElementById('strength').value);
            const decay = parseFloat(document.getElementById('decay').value);
            const iterations = parseInt(document.getElementById('iterations').value);

            // Validate inputs
            if (focus < min || focus > max) {
                alert('Focus phải nằm trong khoảng từ min đến max!');
                return;
            }

            // Khởi tạo mảng đếm
            const counts = {};
            for (let i = min; i <= max; i++) {
                counts[i] = 0;
            }

            // Chạy test
            console.log('Bắt đầu test...');
            const startTime = Date.now();

            for (let i = 0; i < iterations; i++) {
                const result = weightedRandomInt(min, max, focus, strength, decay);
                counts[result]++;
            }

            const endTime = Date.now();
            console.log(`Hoàn thành test trong ${endTime - startTime}ms`);

            // Tính toán thống kê
            const totalTests = iterations;
            const focusCount = counts[focus];
            const focusPercentage = ((focusCount / totalTests) * 100).toFixed(2);
            const average = Object.keys(counts).reduce((sum, key) => sum + (parseInt(key) * counts[key]), 0) / totalTests;

            // Cập nhật thống kê
            document.getElementById('totalTests').textContent = totalTests.toLocaleString();
            document.getElementById('focusCount').textContent = focusCount.toLocaleString();
            document.getElementById('focusPercentage').textContent = focusPercentage + '%';
            document.getElementById('average').textContent = average.toFixed(2);
            document.getElementById('stats').style.display = 'grid';

            // Tạo biểu đồ
            createChart(counts, min, max, focus);
        }

        function createChart(counts, min, max, focus) {
            const ctx = document.getElementById('chart').getContext('2d');

            // Destroy existing chart
            if (chart) {
                chart.destroy();
            }

            const labels = [];
            const data = [];
            const backgroundColors = [];
            const borderColors = [];

            for (let i = min; i <= max; i++) {
                labels.push(i.toString());
                data.push(counts[i]);

                if (i === focus) {
                    backgroundColors.push('rgba(255, 99, 132, 0.8)');
                    borderColors.push('rgba(255, 99, 132, 1)');
                } else {
                    backgroundColors.push('rgba(54, 162, 235, 0.8)');
                    borderColors.push('rgba(54, 162, 235, 1)');
                }
            }

            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Số lần xuất hiện',
                        data: data,
                        backgroundColor: backgroundColors,
                        borderColor: borderColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Số lần xuất hiện'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Giá trị'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `Phân phối kết quả (Focus: ${focus})`,
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Chạy test mặc định khi load trang
        window.onload = function () {
            runTest();
        };
    </script>
</body>

</html>